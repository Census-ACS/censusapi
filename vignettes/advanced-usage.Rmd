---
title: "Advanced censusapi features"
output: 
  rmarkdown::html_vignette:
    df_print: kable
pkgdown:
  as_is: true
description: >
  Learn how to use custom parameters and more.
vignette: >
  %\VignetteIndexEntry{Advanced censusapi features}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r include = FALSE, message = FALSE}
library(censusapi)
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

This package allows access to the full range of the U.S. Census Bureau's APIs. Where the API allows it, you can specify complicated geographies or filter based on a range of parameters. Each API is a little different, so be sure to read the documentation for the specific API that you're using. Also see more examples in the [list of examples](https://hrecht.github.io/censusapi/articles/example-masterlist.html).

### Miscellaneous parameters
Some of the APIs allow complex calls, including specifying a country FIPS code or age. The most commonly used parameters, including `time`, `date`, and `sic` are included as built-in options in `getCensus`, but you can also specify other parameters yourself. (Note: this generally does not apply to the popular American Community Survey and Decennial Census APIs.)

In the SAHIE API, we can filter data by the categorical variables `AGECAT` (age group), `IPRCAT` (income group), `RACECAT` (race) and `SEXCAT` (sex), in addition to geography and year. More information on those variables is available in the [online documentation](https://www.census.gov/data/developers/data-sets/Health-Insurance-Statistics.html).

Here's how to get the uninsured rate (`PCTUI_PT`) for non-elderly adults (`AGECAT = 1`) with incomes of 138 to 400% of the poverty line (`IPRCAT = 5`), by race (`RACECAT`) and state.
```{r}
sahie_nonelderly <- getCensus(
	name = "timeseries/healthins/sahie",
	vars = c("NAME", "PCTUI_PT", "IPR_DESC", "AGE_DESC", "RACECAT", "RACE_DESC"), 
	region = "state:*", 
	year = 2018,
	IPRCAT = 5,
	AGECAT = 1)
head(sahie_nonelderly)
```

Note: data by race is only returned where the population is large enough, so some states will not have rows for some race groups. Here's another example, getting national data from percent uninsured (`PCTUI_PT`) and number uninsured (`NUI_PT`), along with the associated margins of error, by race group and income group for all years.

```{r}
sahie_nonelderly_annual <- getCensus(
	name = "timeseries/healthins/sahie",
	vars = c("NAME", "PCTUI_PT", "PCTUI_MOE", "NUI_PT", "NUI_MOE", "IPRCAT", "IPR_DESC", "AGE_DESC", "RACECAT", "RACE_DESC"), 
	region = "us:*", 
	year = "2006:2018",
	AGECAT = 1)
head(sahie_nonelderly_annual)
```


Other APIs can be filtered too. For example, the [International Data Base](https://www.census.gov/data/developers/data-sets/international-database.html) population projections APIs allow you to get data by age and country.

See what variables the IDB 1 year API allows:
```{r}
listCensusMetadata(
	name = "timeseries/idb/1year", 
	type = "variables")
```

Here's a simple call getting projected population by age for all countries in 2050.
```{r}
pop_2050 <- getCensus(name = "timeseries/idb/1year",
	vars = c("FIPS", "NAME", "AGE", "POP"),
	time = 2050)
head(pop_2050)
```

But we can make a much more specific call by specifying `FIPS` and `AGE` to get just the population projections for teenagers in Portugal.
```{r}
pop_portugal <- getCensus(
	name = "timeseries/idb/1year",
	vars = c("NAME", "POP"),
	time = 2050,
	FIPS = "PO",
	AGE = "13:19")
pop_portugal
```

The [Quarterly Workforce Indicators APIs](https://www.census.gov/data/developers/data-sets/qwi.html) allow even more specific calls.
Here's one example:
```{r}
qwi <- getCensus(
	name = "timeseries/qwi/sa",
	region = "state:02",
	vars = c("Emp", "sex"),
	time = 2012,
	quarter = 1,
	agegrp = "A07",
	ownercode = "A05",
	firmsize = 1,
	seasonadj = "U",
	industry = 21)
qwi
```

